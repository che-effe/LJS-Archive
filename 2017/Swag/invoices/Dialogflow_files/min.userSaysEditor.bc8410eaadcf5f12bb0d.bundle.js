webpackJsonp([11],{128:function(e,t,a){"use strict";var n=a(26),r=a.n(n),i=a(0),s=a.n(i),o=a(1),l=a.n(o),u=a(17),d=function(){function e(t,a){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;s()(this,e),this.editorController=t,this.$element=a,this.modelChangedCb=r,this.paramChangedCb=i,this.editorController.blurCb&&a.bind("blur",this.editorController.blurCb.bind(null,this.editorController.userSaysEditorIndex)),a.bind("blur keyup paste copy cut mousedown markupresize",this.updateModelFromView.bind(this,!1)),a.bind("focus",this.editorController.onFocusCb.bind(this.editorController)),a.on("mouseup",this.mouseUpSelection.bind(this)),a.on("mousedown",e.clearCursorSelection),Mousetrap(a[0]).bind(["ctrl+e","command+e"],function(e){e.preventDefault(),n.onEditKeydown(e)}),this.getComputedDisplay=void 0!==window.getComputedStyle?function(e){return window.getComputedStyle(e,null).display}:function(e){return e.currentStyle.display},this.updateView(!0)}return l()(e,[{key:"updateModelFromView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.userSaysHtmlString=this.$element.html();var t=u.a.parse(this.userSaysHtmlString,this.editorController.userSays.isTemplate,this.editorController.userSays.count,this.editorController.userSays.id,this.editorController.userSays.updated);r()(this.editorController.userSays)!==r()(t)?(this.editorController.userSays.data=t.data,this.editorController.userSays.isTemplate=t.isTemplate,this.modelChangedCb&&this.modelChangedCb(),this.updateView(e),this.editorController.$scope.$root.$$phase||this.editorController.$scope.$apply()):this.modelChangedCb&&this.modelChangedCb()}},{key:"updateView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=u.a.glue(this.editorController.userSays,this.editorController.userSaysEditorIndex);if(this.editorController.UtilsService.replaceHtmlEscapeToChar(t)!==this.editorController.UtilsService.replaceHtmlEscapeToChar(this.userSaysHtmlString))if(this.userSaysHtmlString=t,e)this.$element.html(t);else{var a=rangy.getSelection(),n=a.saveCharacterRanges(this.$element[0]),r=this.$element.text().length;this.$element.html(t);var i=this.$element.text().length;r>i?n[0]&&(n[0].characterRange.end+=i-r,n[0].characterRange.start=n[0].characterRange.end,a.restoreCharacterRanges(this.$element[0],n)):a.restoreCharacterRanges(this.$element[0],n)}}},{key:"mouseUpSelection",value:function(e){if(this.editorController.userSays.isTemplate)return!1;var t=window.getSelection();return t.isCollapsed?t.isCollapsed&&"SPAN"===e.target.nodeName?this.onClick(e):void 0:this.onSelect(e)}},{key:"setCursorToEnd",value:function(){var e=rangy.createRange();e.setStart(this.$element[0],this.$element[0].length||this.$element[0].childNodes.length),e.collapse(!0),rangy.getSelection().setSingleRange(e)}},{key:"onEditKeydown",value:function(e){var t,a=window.getSelection(),n={},r={};if(n.target=e.target,a.isCollapsed){var i=a.anchorNode.parentElement;$(i).hasClass("selection")&&(n.target=i)}if(a.rangeCount){var s=a.getRangeAt(0).cloneRange();if(s.getClientRects){s.collapse(!0);var o=s.getClientRects();if(o.length>0&&(t=o[0]),t){var l=$(document).scrollTop();n.pageX=t.right,n.pageY=t.bottom+l}}}_.assign(r,n),this.mouseUpSelection(r)}},{key:"onSelect",value:function(t){var a=this;if(!this.editorController.markupDisabled&&!this.editorController.userSaysDisabled){var n=this.editorController.selectParameter.getPosition(t.pageX,t.pageY,t,410),r=rangy.getSelection(),i=r.saveCharacterRanges(this.$element[0]),s=this.editorController.autocompleteDisabled?null:r.toString(),o=this.$element.text().trim();this.editorController.selectParameter.updateMeta(s===o),this.editorController.selectParameter.open(this.$element,this.editorController.getAutocompleteEntities(),null,s,{left:n.left,top:n.top}).result.then(function(t){var n=void 0,s=void 0;t.alias||(n=a.editorController.autoParams.map(function(e){return e.alias}),s=a.editorController.MetaAliasService.getAlias(t.meta),t.alias=a.editorController.MetaAliasService.selectCandidateName(s,n)),r.restoreCharacterRanges(a.$element[0],i),a.removeSelectionFormatting(a.$element),u.a.surroundRange(t.meta,t.alias,!0),r.restoreCharacterRanges(a.$element[0],i),e.clearCursorSelection(),a.updateModelFromView(!0),a.editorController.paramAdded(t.alias,t.meta),a.setCursorToEnd()},function(e){return!1})}}},{key:"onClick",value:function(e){var t=this;if(!this.editorController.markupDisabled&&!this.editorController.userSaysDisabled){var a=angular.element(e.target),n={};if(n.value=a.attr("selection-value"),n.bgColor=a[0].style.backgroundColor,n.alias=a.attr("selection-alias"),n.value&&n.value!==u.b.IGNORE){var r=this.editorController.selectParameter.getPosition(e.pageX,e.pageY,e,458),i=this.editorController.autocompleteDisabled?null:a.text();this.editorController.selectParameter.open(this.$element,this.editorController.getAutocompleteEntities(),n,i,{left:r.left,top:r.top}).result.then(function(e){e.alias||(e.meta===u.b.IGNORE?e.alias=!1:e.alias=t.editorController.MetaAliasService.getAlias(e.meta)),a.attr("selection-value",e.meta),a.attr("selection-alias",e.alias),a.attr("selection-user-defined"),t.updateModelFromView(!0),t.editorController.paramChanged(n.alias,e.alias,n.value,e.meta),t.setCursorToEnd()},function(e){return!1})}}}},{key:"removeSelectionFormatting",value:function(t){var a=this,n=rangy.getSelection();if(!n.isCollapsed)for(var r,i=0;i<n.rangeCount;++i){var s=n.saveCharacterRanges(t[0]);r=n.getRangeAt(i),r.splitBoundaries();for(var o,l=r.getNodes([1],function(e){return"BR"!==e.tagName&&"inline"===a.getComputedDisplay(e)}),u=0;o=l[u++];)e.replaceWithOwnChildren(o);"SPAN"===r.startContainer.parentNode.tagName&&e.replaceWithOwnChildren(r.startContainer.parentNode),n.restoreCharacterRanges(t[0],s)}}}],[{key:"replaceWithOwnChildren",value:function(e){for(var t=e.parentNode;e.hasChildNodes();)t.insertBefore(e.firstChild,e);t.removeChild(e)}},{key:"clearCursorSelection",value:function(){return document.selection?document.selection.empty():window.getSelection&&window.getSelection().empty?window.getSelection().empty():window.getSelection&&window.getSelection().removeAllRanges?window.getSelection().removeAllRanges():void 0}}]),e}();t.a=d},13:function(e,t,a){"use strict";var n=a(0),r=a.n(n),i=a(1),s=a.n(i);a.d(t,"a",function(){return o});var o=function(){function e(){r()(this,e)}return s()(e,null,[{key:"publish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.observers[e]&&this.observers[e].forEach(function(a){a(e,t)})}},{key:"subscribe",value:function(e,t){this.observers[e]||(this.observers[e]=[]),this.observers[e].push(t)}},{key:"unsubscribe",value:function(e,t){if(this.observers[e]){var a=this.observers[e].findIndex(function(e){return e===t});if(!(a<0))return this.observers[e].splice(a,1),!0}}},{key:"unsubscribeAllFromEvent",value:function(e){delete this.observers[e]}}]),e}();o.observers={},function(e){!function(e){e[e.DEPRECATED_DOMAINS_TURNED_OFF=0]="DEPRECATED_DOMAINS_TURNED_OFF",e[e.CURRENT_AGENT_CHANGED=1]="CURRENT_AGENT_CHANGED",e[e.AGENT_DATA_UPDATE=2]="AGENT_DATA_UPDATE",e[e.AGENT_UPLOAD_SUCCESS=3]="AGENT_UPLOAD_SUCCESS"}(e.DEFINED_EVENTS||(e.DEFINED_EVENTS={}))}(o||(o={}))},151:function(e,t){e.exports='<div class="input-row-form templates-holder"\n     ng-click="vm.userSaysEditorFocusedIndex = vm.userSaysEditorIndex; vm.userSaysEditorFocusedCb()"\n     ng-class="{\'active-table\': vm.userSaysEditorFocusedIndex === vm.userSaysEditorIndex || vm.showTable }"\n     tabindex="-1">\n    <div class="input-group">\n        <md-button\n                ng-if="vm.usesPureTemplates && vm.customClassifierAvailable"\n                ng-click="vm.switchIsTemplate()"\n                class="md-icon-button template-editor-mode-switcher"\n                aria-label="Template"\n                tabindex="-1"\n        >\n            <i class="fa" ng-class="{\'fa-at\': vm.userSays.isTemplate, \'fa-quote-right\': !vm.userSays.isTemplate}"></i>\n            <md-tooltip md-direction="top" md-delay="100">\n                Example mode (") contains normal speech and can be annotated by linking a word or phrase to an entity. Template mode (@) contains entity references and cannot be annotated. Click to toggle modes.\n            </md-tooltip>\n        </md-button>\n\n        <div\n                resize-selections\n                class="form-control template-editor-holder b-user-says-editor"\n                ng-class="{\'custom-classifier-enabled\': vm.usesPureTemplates && vm.customClassifierAvailable }"\n                contenteditable="{{!vm.userSaysDisabled && !vm.isAgentReadOnly}}"\n                spellcheck="true"\n                placeholder="{{vm.placeholder}}"\n                safe-paste\n                ng-keydown="vm.innerKeyDownCb($event)"\n                ng-disabled="vm.userSaysDisabled || vm.isAgentReadOnly"\n                ng-model="vm.userSays"\n                max-length="{{vm.maxInputLength}}"\n                completer-template-editor="templateEditorCommonConfig"\n        ></div>\n        <div class="list-group-ico-item">\n            <a class="ico-item intent-template-remove" id="intent-template-remove-{{::vm.userSaysEditorIndex}}" ng-if="!!vm.deleteCb && !vm.isAgentReadOnly" ng-click="vm.deleteCb(vm.userSaysEditorIndex)" tabindex="-1">\n                <span class="glyphicon glyphicon-trash" ></span>\n            </a>\n        </div>\n    </div>\n    <div ng-if="vm.autoParams.length && (vm.userSaysEditorFocusedIndex === vm.userSaysEditorIndex || vm.showTable)" class="template-table-animationIf input-group template-table">\n        <table class="content-table intent-parameters-table">\n            <thead>\n            <tr>\n                <th>Parameter name</th>\n                <th>Entity</th>\n                <th>Resolved value</th>\n                <th class="param-actions"></th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr class="autoparams template-editor-params-tr" ng-repeat="param in vm.autoParams track by $index">\n                <td>\n                    <input class="user-says-alias-editor template-editor-param-alias-editor"\n                           ng-model="param.alias"\n                           ng-change="vm.changeParamAlias(param, \'{{param.alias}}\', $event)" tabindex="-1"\n                           ng-keydown="vm.paramKeyDownCb($event)"\n                           maxlength="{{vm.limitsManager.getTextLength(\'param\')}}"\n                           ng-disabled="vm.isAgentReadOnly"\n                    />\n                </td>\n                <td class="template-editor-param-meta-holder-wrapper">\n                    <span style="background-color: {{vm.getBgColor(param)}}" class="meta-holder template-editor-param-meta-holder" ng-bind="param.meta" ng-click="vm.startSelectParameter(param, $event)" tabindex="-1"></span>\n                </td>\n                <td class="template-editor-param-resolved-value">\n                    <span tabindex="-1">{{(param.text) ? param.text : "&mdash;"}}</span>\n                </td>\n                <td  class="param-actions">\n                    <button class="btn-icon" ng-click="vm.removeParam(param, $index)" type="button" tabindex="-1" ng-disabled="vm.isAgentReadOnly">\n                        <span class="flaticon stroke x-1"></span>\n                    </button>\n                </td>\n            </tr>\n            </tbody>\n        </table>\n    </div>\n</div>'},154:function(e,t,a){var n=a(304);"string"==typeof n&&(n=[[e.i,n,""]]);a(7)(n,{});n.locals&&(e.exports=n.locals)},26:function(e,t,a){e.exports={default:a(64),__esModule:!0}},304:function(e,t,a){t=e.exports=a(6)(),t.push([e.i,".b-user-says-editor {\n  height: auto;\n}\n.b-user-says-editor.form-control {\n  height: auto;\n}\nuser-says-editor .templates-holder .template-editor-holder {\n  word-break: break-all;\n  word-wrap: break-word;\n  white-space: pre-wrap;\n}\nuser-says-editor .templates-holder .intent-template-remove {\n  display: none;\n}\nuser-says-editor .templates-holder:hover .intent-template-remove {\n  display: block;\n}\nuser-says-editor td.param-actions {\n  padding: 0 !important;\n}\n",""])},383:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(26),r=a.n(n),i=a(0),s=a.n(i),o=a(1),l=a.n(o),u=a(9),d=a.n(u),c=a(5),m=a.n(c),h=a(11),p=a.n(h),v=a(128),g=a(17),f=a(8),S=a(12),y=a(13),C=this&&this.__decorate||function(e,t,a,n){var r,i=arguments.length,s=i<3?t:null===n?n=p()(t,a):n;if("object"===("undefined"==typeof Reflect?"undefined":m()(Reflect))&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,a,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(t,a,s):r(t,a))||s);return i>3&&s&&d()(t,a,s),s};a(154);var b=function(){function e(t,a,n,r,i,o,l,u,d,c,m){var h=this;s()(this,e),this.$scope=a,this.$timeout=n,this.$sce=r,this.selectParameter=i,this.MetaAliasService=o,this.UtilsService=l,this.CurrentAgentService=u,this.$element=d,this.METAS=c,this.limitsManager=m,this.markupDisabled=!1,this.autoSyncDisabled=!1,this.placeholder="Enter user expression",this.showTable=!1,this.updateSingleViewInnerCb=function(e,t){t.index===h.userSaysEditorIndex&&h.updateViewSkipFocusCancellingCb()},this.updateViewInnerCb=function(){h.userSaysEditorFocusedIndex=null,h.updateViewSkipFocusCancellingCb()},this.changeParamAlias=function(e,t,a){var n=_.clone(e);n.alias=t;var r=g.a.replaceParamForTemplate(h.userSays,e,n);h.userSays.data=r.data,h.paramChanged(t,e.alias,e.meta,e.meta),h.domHelper.updateView(!0),h.domHelper.updateModelFromView(!0)},this.getBgColor=function(e){return g.a.getPainter().getColorByAlias(e.alias)},this.startSelectParameter=function(e,t){if(h.userSaysDisabled)return!1;var a=h;if(e.meta===h.METAS.INLINE||e.meta===h.METAS.IGNORE)return!1;if(h.markupDisabled)return!1;var n=e.meta,r=e.alias,i=t.currentTarget||t.srcElement,s=$(i).offset(),o=s.left+$(i).width(),l=s.top+$(i).height(),u=h.selectParameter.getPosition(o,l,t,410);h.selectParameter.open($(i),h.getAutocompleteEntities(),e.meta,null,{left:u.left,top:u.top}).result.then(function(t){var i=_.clone(e);if(!t.alias){var s=a.autoParams.map(function(e){return e.alias});t.alias=g.a.replaceIfNeedToChangeAliasWithMeta(e.meta,t.meta,e.alias,e.alias,s)}e.meta=t.meta,e.alias=t.alias,a.userSays.data=g.a.replaceParamForTemplate(a.userSays,e,i).data,a.domHelper.updateView(!0),a.paramChanged(r,e.alias,n,e.meta)},function(e){})},this.removeParam=function(e,t){var a=_.clone(e);e.meta=h.METAS.IGNORE,e.alias=!1,h.userSays.data=g.a.replaceParamForTemplate(h.userSays,e,a).data,h.paramChanged(a.alias,!1,a.meta,h.METAS.IGNORE),h.autoParams.splice(t,1),h.domHelper.updateView(!0),h.domHelper.updateModelFromView(!0)},t.listAutocomplete().then(function(e){h.autocompleteEntities=e.entities})}return e.$inject=["AutocompleteData","$scope","$timeout","$sce","selectParameter","MetaAliasService","UtilsService","CurrentAgentService","$element","METAS","limitsManager"],l()(e,[{key:"$onInit",value:function(){var e=this;this.customClassifierAvailable=this.CurrentAgentService.useCustomClassifier(),this.deletable=!!this.deleteCb,this.$scope.$on("updateView",this.updateViewInnerCb),this.$scope.$on("updateSingleView",this.updateSingleViewInnerCb),y.a.subscribe("updateView",this.updateViewInnerCb),y.a.subscribe("updateSingleView",this.updateSingleViewInnerCb),this.updateAutoParams(),this.domHelper=new v.a(this,this.$element.find(".b-user-says-editor"),this.updateAutoParams.bind(this)),this.userSaysEditorFocusedIndex===this.userSaysEditorIndex&&this.$timeout(function(){e.$element.find(".template-editor-holder").focus(),e.autoParams.length&&e.$element.find(".template-table").show()}),this.$scope.templateEditorCommonConfig=this.autoCompleteConfig}},{key:"$onDestroy",value:function(){y.a.unsubscribe("updateView",this.updateViewInnerCb),y.a.unsubscribe("updateSingleView",this.updateSingleViewInnerCb)}},{key:"updateViewSkipFocusCancellingCb",value:function(){var e=this;this.$timeout(function(){e.updateAutoParams(),e.domHelper.updateView(!0),e.domHelper.updateModelFromView(!0)})}},{key:"switchIsTemplate",value:function(){if(g.a.templateHasAnnotatedMetas(this.userSays))return void f.a.error("Before converting annotated examples to the template mode, remove the annotation.");this.userSays.isTemplate=!this.userSays.isTemplate,this.domHelper.updateView(!0)}},{key:"trust",value:function(){return this.$sce.trustAsHtml(this.domHelper.userSaysHtmlString)}},{key:"updateAutoParams",value:function(){var e=g.a.getParametersFromTemplate(this.userSays);if(r()(this.autoParams)!==r()(e)){if(this.autoParams=e,this.autoSyncDisabled)return;this.$scope.$emit("userSaysParamsChanged",{changedParams:e,index:this.userSaysEditorIndex})}}},{key:"innerKeyDownCb",value:function(e){if(this.isInputLimitExceeded(e))return!1;this.keyDownCb&&!e.isDefaultPrevented()&&this.keyDownCb(e),13===e.which&&(e.preventDefault(),e.stopPropagation())}},{key:"paramKeyDownCb",value:function(e){if(this.userSays.isTemplate&&this.isInputLimitExceeded(e))return!1}},{key:"paramChanged",value:function(e,t,a,n){if(!this.autoSyncDisabled){var r={index:this.userSaysEditorIndex,oldName:e,oldMeta:a,newName:t,newMeta:n};this.$scope.$emit("userSaysParamChanged",r)}}},{key:"paramAdded",value:function(e,t){if(!this.autoSyncDisabled){var a={index:this.userSaysEditorIndex,oldName:null,oldMeta:null,newName:e,newMeta:t};this.$scope.$emit("userSaysParamChanged",a)}}},{key:"onFocusCb",value:function(){var e=this;this.showTable||this.$timeout(function(){e.userSaysEditorFocusedIndex=e.userSaysEditorIndex})}},{key:"getAutocompleteEntities",value:function(){return this.autocompleteDisabled?[]:this.autocompleteEntities}},{key:"isInputLimitExceeded",value:function(e){if(angular.isDefined(this.maxInputLength)&&this.UtilsService.isPrintableKeycode(e.which)){if(g.a.glueClean(this.userSays).length+1>this.maxInputLength)return e.preventDefault(),e.stopPropagation(),!0}return!1}}]),e}();b=C([a.i(S.c)({bindings:{userSays:"=",userSaysEditorFocusedIndex:"=",userSaysEditorIndex:"=",keyDownCb:"<",blurCb:"<",deleteCb:"<",userSaysEditorFocusedCb:"=",usesPureTemplates:"<",markupDisabled:"<",userSaysDisabled:"<",placeholder:"@",autoSyncDisabled:"<",showTable:"<",autoCompleteConfig:"<",maxInputLength:"<",autocompleteDisabled:"<",isAgentReadOnly:"<"},template:a(151)})],b),t.default=b,angular.module("api.components").component("userSaysEditor",b)},64:function(e,t,a){var n=a(10),r=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return r.stringify.apply(r,arguments)}},8:function(e,t,a){"use strict";var n=a(0),r=a.n(n),i=a(1),s=a.n(i);a.d(t,"a",function(){return o});var o=function(){function e(){r()(this,e)}return s()(e,null,[{key:"notify",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Status.INFO;e.showStatus(t,a)}},{key:"info",value:function(t){e.showStatus(t,e.Status.INFO)}},{key:"infoHTML",value:function(t){e.showStatus(t,e.Status.INFO,!0)}},{key:"error",value:function(t){e.showStatus(t,e.Status.ERROR)}},{key:"errorHTML",value:function(t){e.showStatus(t,e.Status.ERROR,!0)}},{key:"success",value:function(t){e.showStatus(t,e.Status.SUCCESS)}},{key:"stdErrorSkipIfEmpty",value:function(t){try{var a=t.data.status.errorDetails;a&&e.error(a)}catch(e){}return e.getQService().reject(t)}},{key:"stdErrorHtml",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error";return e.stdError(t,a,!0)}},{key:"stdError",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.getStdErrorMessageFromXhr(t);return r||(r=e.getStdErrorMessageFromResponse(t)),n?e.errorHTML(r||a):e.error(r||a),e.getQService().reject(t)}},{key:"stdErrorNoReject",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Error";e.stdError(t,a).catch(function(){})}},{key:"showStatus",value:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Status.INFO,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.getService().showStatus(t,a,n)}},{key:"getService",value:function(){return this.statusesService||(this.statusesService=angular.element(document.body).injector().get("statusesService")),this.statusesService}},{key:"getQService",value:function(){return this.qService||(this.qService=angular.element(document.body).injector().get("$q")),this.qService}},{key:"getStdErrorMessageFromXhr",value:function(e){return _.has(e,"data.status.errorDetails")?e.data.status.errorDetails:null}},{key:"getStdErrorMessageFromResponse",value:function(e){return _.has(e,"status.errorDetails")?e.status.errorDetails:null}}]),e}();o.statusesService=null,o.qService=null,function(e){!function(e){e[e.ERROR="error"]="ERROR",e[e.INFO="info"]="INFO",e[e.SUCCESS="success"]="SUCCESS"}(e.Status||(e.Status={}))}(o||(o={}))}},[383]);